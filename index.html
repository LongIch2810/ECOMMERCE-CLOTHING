<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Snake Game</title>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #222;
        margin: 0;
      }
      canvas {
        background-color: #111;
        border: 2px solid #fff;
      }
    </style>
  </head>
  <body>
    <canvas id="gameCanvas"></canvas>
    <script>
      // Lấy canvas và context
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");

      // Kích thước canvas
      const boxSize = 20;
      const canvasSize = 20; // Số ô trên mỗi hàng/cột
      canvas.width = boxSize * canvasSize;
      canvas.height = boxSize * canvasSize;

      // Khởi tạo rắn
      let snake = [{ x: 10 * boxSize, y: 10 * boxSize }];
      let direction = "RIGHT";
      let food = spawnFood();
      let score = 0;

      // Hàm vẽ rắn
      function drawSnake() {
        snake.forEach((segment, index) => {
          ctx.fillStyle = index === 0 ? "lime" : "green";
          ctx.fillRect(segment.x, segment.y, boxSize, boxSize);
          ctx.strokeStyle = "black";
          ctx.strokeRect(segment.x, segment.y, boxSize, boxSize);
        });
      }

      // Hàm tạo mồi ngẫu nhiên
      function spawnFood() {
        return {
          x: Math.floor(Math.random() * canvasSize) * boxSize,
          y: Math.floor(Math.random() * canvasSize) * boxSize,
        };
      }

      // Hàm vẽ mồi
      function drawFood() {
        ctx.fillStyle = "red";
        ctx.fillRect(food.x, food.y, boxSize, boxSize);
      }

      // Hàm cập nhật trạng thái game
      function updateGame() {
        // Lấy vị trí đầu tiên của rắn
        let head = { ...snake[0] };

        // Cập nhật vị trí đầu theo hướng
        if (direction === "UP") head.y -= boxSize;
        if (direction === "DOWN") head.y += boxSize;
        if (direction === "LEFT") head.x -= boxSize;
        if (direction === "RIGHT") head.x += boxSize;

        // Kiểm tra va chạm với tường hoặc chính nó
        if (
          head.x < 0 ||
          head.x >= canvas.width ||
          head.y < 0 ||
          head.y >= canvas.height ||
          checkCollision(head)
        ) {
          alert("Game Over! Điểm: " + score);
          document.location.reload();
        }

        // Kiểm tra rắn ăn mồi
        if (head.x === food.x && head.y === food.y) {
          food = spawnFood();
          score++;
        } else {
          snake.pop(); // Xóa đuôi nếu không ăn mồi
        }

        // Thêm đầu mới vào rắn
        snake.unshift(head);
      }

      // Hàm kiểm tra va chạm với chính nó
      function checkCollision(head) {
        return snake.some(
          (segment, index) =>
            index !== 0 && segment.x === head.x && segment.y === head.y
        );
      }

      // Hàm vẽ game
      function drawGame() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawFood();
        drawSnake();
        updateGame();
      }

      // Xử lý phím bấm
      document.addEventListener("keydown", (event) => {
        if (event.key === "ArrowUp" && direction !== "DOWN") direction = "UP";
        if (event.key === "ArrowDown" && direction !== "UP") direction = "DOWN";
        if (event.key === "ArrowLeft" && direction !== "RIGHT")
          direction = "LEFT";
        if (event.key === "ArrowRight" && direction !== "LEFT")
          direction = "RIGHT";
      });

      // Chạy game
      setInterval(drawGame, 150);
    </script>
  </body>
</html>
